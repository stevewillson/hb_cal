<%
    var weekday = new Array(7);
    weekday[0] = "S";
    weekday[1] = "M";
    weekday[2] = "T";
    weekday[3] = "W";
    weekday[4] = "T";
    weekday[5] = "F";
    weekday[6] = "S";

    var hb_cal_table = '';

    hb_cal_table = '<div class="hb_cal">';
    hb_cal_table += '<table id="hb_table" class style="height: 30px; border: 1px solid black;">';
    hb_cal_table += '<tr>';

    for (i = 0; i <= 31; i++) {
      // TODO - highlight the day of the month here
      // set the date with a leading zero if the day of the month is less than 10
      if (i < 10) {
        i = "0" + i.toString();
      }

      // calculate the day of the week and the day of the month
      var date_string = "2019-07-" + i + "T12:00:00Z";
      var d = new Date(date_string);
      var n = weekday[d.getDay()];

      hb_cal_table += '<th class="widget-header" data-date="2019-08-' + i + '" style="border: 1px solid black;">\n';
      hb_cal_table += '<div class="cell-content">\n';
      if (i != 0) {
        hb_cal_table += '<span class="cell-text">' + i + ' ' + n + '</span>\n';
      }
      hb_cal_table += '</div>\n';
      hb_cal_table += '</th>\n';;
    }

  hb_cal_table += '</tr>';

        // make a new row for each category
        var rows = '';
	for (i = 0; i < events.length; i++) {
          try {
            var cur_cat = events[i].category;
            //console.log("cur_cat is " + cur_cat);
          }
          catch(err){
            var cur_cat = "undefined";
          }
          try {
            var prev_cat = events[i-1].category
            //console.log("prev_cat is " + prev_cat);
          }
          catch(err){
            var prev_cat = "undefined";
            //console.log("prev_cat is undefined");
          }
          try {
            var next_cat = events[i+1].category
            //console.log("next_cat is " + next_cat);
          }
          catch(err){
            var next_cat = "undefined";
            //console.log("next_cat is undefined");
          }

          if (cur_cat != prev_cat) {
            // new category, set a new row
            //console.log("cur_cat is " + cur_cat);
            //console.log("prev_cat is " + prev_cat);
            rows += '<tr data-resource-id="' + events[i].category + '">';
            rows += '<td>\n';
            rows += events[i].category;
            rows += '</td>\n';
          }
          //rows += '<div class="cell-content">\n';
          // check to see if the category changed 
	  for (j = 1; j <= 31; j++) {
            // calculate the start of the day 
            var cur_date = new Date();
            var end_date = new Date();
            cur_date.setTime(Date.parse(events[i].date_start));
            end_date.setTime(Date.parse(events[i].date_end));
            //console.log(events[i].date_start);
            //console.log(cur_date.getUTCDate());
            event_length = end_date.getUTCDate() - cur_date.getUTCDate() + 1;
            if( cur_date.getUTCDate() == j) {
              rows += '<td class = "' + events[i].eventtype + '" colspan = "' + event_length + '" style="height: 30px; border: 1px solid black;">\n';
              // update j with how long the event occurred
              j = j + event_length - 1;
              rows += '<form name="delevent" method="post" action="/delevent"><input type="hidden" name="documentid" ';
              rows += 'value="' + events[i]._id + '"><button class="linkButton" type="submit">';
              rows += events[i].event;
              rows += '</button></form>';
              //rows += events[i].event;
              // move on to the next event, but only if cur_cat == next_cat
              //console.log("cur_cat is " + cur_cat);
              //console.log("next_cat is " + next_cat);
              //console.log("");
              // look ahead to the next event in the category, this allows events for the same category to exist on the same row
              if(cur_cat == next_cat) {
                i = i + 1;
                //console.log("event index is incremented");
                // update cur_cat and next_cat
                try {
                  var cur_cat = events[i].category;
                  //console.log("cur_cat is " + cur_cat);
                }
                catch(err){
                  var cur_cat = "undefined";
                }
                try {
                  var next_cat = events[i+1].category
                  //console.log("next_cat is " + next_cat);
                }
                catch(err){
                  var next_cat = "undefined";
                  //console.log("next_cat is undefined");
                }
              //console.log("");
              }
              rows += '</td>\n';
            } else {
              rows += '<td colspan = "1">\n';
              //rows += j + '\n';
              rows += '</td>\n';
            }
	  }
          
          if (cur_cat != prev_cat) {
            // new category, after finishing the row, finish the row
            rows += '</tr>';
          }
	}

  hb_cal_table += rows;
  hb_cal_table += '</table>';
  hb_cal_table += '</div>';
  %>

  <%- hb_cal_table %>

    <ul>
    <%
        var list = '';
	for (i = 0; i< events.length; i++) {
	  list += '<li>Category: ' + events[i].category + ', Event: ' + events[i].event;
          list += ' Start: ' + events[i].date_start + ', End: ' + events[i].date_end +  '<form name="delevent" method="post" action="/delevent"><input type="hidden" name="documentid" value="' + events[i]._id + '"><button class="linkButton" type="submit">Del</button></form></li>';
	}
      %>
      <%- list %>
    </ul>
